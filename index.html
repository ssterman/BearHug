
<html>
    <head>
        <script src="http://simplewebrtc.com/latest.js"></script>
        <script type="text/javascript" src="https://cdn.firebase.com/v0/firebase.js"></script>
        <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script> 
        <link rel="stylesheet" href="index.css" type="text/css"></link>
    </head>
    <body>

        <div class="header">
            <h1> BearHug </h1>
            <h3>Video Chat with Physical Interactions</h3>
        </div>

        <div id="masterContainer">

            <div id="videoContainer">
                <div id="localContainer">
                	<video id="localVideo"></video>
                </div>
                <div id="remoteContainer"></div>
            </div>

            <div id="animationContainer">
                <div id="animation_me_div" class="avatar">
                    <img id="animation_me" src="standing.png" >
                </div>
                <div id="animation_you_div" class="avatar">
                    <img id="animation_you" src="standing.png">
                </div>
            </div>

            <div id="buttonContainer">
            	<button type="button" id="hugBtn" onclick="trigger_hug(this)">Hug!</button>
            	<button type="button" id="patBtn" onclick="trigger_pat(this)">Pat!</button>
            	<button type="button" id="kissBtn" onclick="trigger_kiss(this)">Kiss!</button>
            </div>
        </div>

        <script src="move.js"></script>
       <script>
             var userID = Math.floor(Math.random()*1000000);
             console.log(userID);
             // Buttons / interactions 
             var interactionOptions = ["#hugBtn", "#patBtn", "#kissBtn"];
            
            var webrtc = new SimpleWebRTC({
              // the id/element dom element that will hold "our" video
              localVideoEl: 'localVideo',
              // the id/element dom element that will hold remote videos
              remoteVideosEl: 'remoteContainer',
              // immediately ask for camera access
              autoRequestMedia: true
            });

            // we have to wait until it's ready
            webrtc.on('readyToCall', function () {
              // you can name it anything
              webrtc.joinRoom('cs247');
            });

            //firebase setup            
            fb_instance = new Firebase("https://avatar-gestures.firebaseio.com/");

            function send_trigger(msg) {
                fb_instance.push({m: msg, sender: userID});
            }
            
            fb_instance.on('child_added', function(snapshot){
                var msg = snapshot.val().m;
                var senderIsMe = (snapshot.val().sender == userID);
                console.log("RECEIVED: " + msg);
                console.log("SENDER IS ME: " + senderIsMe);
                fb_instance.remove();
                // if (msg == "hug") {
                //     animateHug(senderIsMe); 
                // } else if (msg == "kiss") {
                //     animateKiss(senderIsMe);
                // } else if (msg == "pat") {
                //     animatePat(senderIsMe);
                // }
                animate(senderIsMe, msg);
            });

            // where option = 'enabled' or 'disabled'
            function toggle_enable_buttons(enabled) {
                var arrayLength = interactionOptions.length;
                for (var i = 0; i < arrayLength; i++) {
                    if (!enabled) {
                        $(interactionOptions[i]).attr('disabled', 'disabled');
                    } else {  // disabled
                        $(interactionOptions[i]).removeAttr("disabled")
                    }
                }
            }

            function trigger_hug(el) {
                toggle_enable_buttons(false);
                send_trigger("hug");
            }

            function trigger_pat(el) {
                toggle_enable_buttons(false);
                send_trigger("pat");
            }

            function trigger_kiss(el) {
                toggle_enable_buttons(false);
                send_trigger("kiss");
            }

            // function animateHug(senderIsMe) {
            //     var container = document.getElementById("animationContainer");
            //     var me = document.getElementById("animation_me");
            //     var you = document.getElementById("animation_you");
            //     animateWalk(senderIsMe);
            //     setTimeout(function(){$("#animation_me_div").html("<img src='hugging.gif'>")}, 5000);
            // }

            function animate(senderIsMe, interactionType) {
                console.log("walking");
                var container = document.getElementById("animationContainer");
                var me = document.getElementById("animation_me");
                var you = document.getElementById("animation_you");
                var myLeftOffset = $("#animation_me_div").offset().left;
                var yourLeftOffset = $("#animation_you_div").offset().left;
                
                if (senderIsMe) {
                    console.log("I am sender");
                    var senderID = '#animation_me_div';
                    var displacement = yourLeftOffset-myLeftOffset;
                } else { // sender is the other person
                    console.log("I am receiver");
                    var senderID = '#animation_you_div';
                    var displacement = myLeftOffset-yourLeftOffset;
                }
        
                // if walking to the left, make the gif face left
                if (displacement < 0) {
                    $(senderID).addClass("flip");
                }
                 move(senderID)
                  .set('margin-left', displacement)
                  .duration('5s')
                  .then()
                      .scale(1.5)
                      .pop()
                  .end();
                  $(senderID).html("<img src='walking.gif'>");

                  interact(interactionType, senderID);

                  setTimeout(function(){
                      // flip bear other way
         
                      move(senderID)
                      .set('margin-left', 0)
                      .duration('5s')
                      .end();
                      $(senderID).html("<img src='walking.gif'>");
                      setTimeout(function(){
                         $(senderID).html("<img src='standing.png'>")
                         toggle_enable_buttons(true); // re-enable buttons
                      }, 5000);
                  }, 9000);


                  
           
                
                // Right now just x-axis, but changing it to 2D path should be easy
               

            }

            // params: interactionType eg. "hug" and who sent the hug aka which DIV does the hugging action eg. animation_you_div
            function interact(interactionType, senderID) {
            switch (interactionType){
                case "hug": 
                    setTimeout(function(){$(senderID).html("<img src='hugging.gif'>")}, 5000);
                    break;
                case "kiss": 
                    setTimeout(function(){$(senderID).html("<img src='kissing.gif'>")}, 5000);
                    break;
                case "pat": 
                    setTimeout(function(){$(senderID).html("<img src='patting.gif'>")}, 5000);
                    break;
                }
            }

            //reference: http://www.schillmania.com/content/projects/javascript-animation-1/
            // function move(me, you) {
            //     me.style.left = parseInt(me.style.left)+1+'px';
            //     if (me.left != you.left) {
            //         setTimeout(move(me, you),20); // call doMove in 20msec
            //     } else {
            //         me.src ="hug.gif";
            //     }
            // }
       </script>

<!--  TESTING
<style>
     .box{display:block;width:50px;height:25px;background-color:#222;}
    </style>
     <script>
      addEventListener('DOMContentLoaded', function(){
        setInterval(function(){
            move('.box').x(600).duration('1s').set('width',5).end();
            setTimeout(function(){move('.box').x(0).duration('1s').set('width',50).end();},1000)
        },2500)
      }, false);
    </script>
    <div class="box"></div> -->

    </body>
</html>
>>>>>>> 97f4885b70615886052ffd273264127a2fa7bf89
